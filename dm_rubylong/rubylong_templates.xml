<?xml version="1.0" encoding="utf-8"?>
<!-- vim:fdn=3:
-->
<openerp>
    <data>
        <template id="dm_rubylong.layout" name="Rubylong layout">&lt;!DOCTYPE html&gt;
            <html style="height: 100%">
                <head>
                    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
                    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
                    <title>Odoo</title>                    
    				<script src="/dm_rubylong/static/CreateControl.js" type="text/javascript"></script>
    				<script src="/dm_rubylong/static/GRInstall.js" type="text/javascript"></script>   
					<script type="text/javascript" id="rubylong_js">   
						function OnSaveReport()
						{
							//设置 DefaultAction 属性为 false，不执行控件本身的默认保存行为
							ReportDesigner.DefaultAction = false;							
						    ReportDesigner.Post();  //将设计器中的设计数据提交到报表对象						    
						    var ReportName = "1a_new.grf"; //这里可以是一个参数化的变量
						    var LoadURL = "/report/html/38?Report=" + ReportName + '?dt=' + cur_time;
						    alert(LoadURL);
						    var success = ReportDesigner.Report.SaveToURL( encodeURI(LoadURL) );
						    if ( success )
						        alert("保存报表成功!");
						    else
						        alert("保存报表失败!");
						}						 
					</script>
					<script type="text/javascript" id="rubylong_run">
					    var cur_time = new Date().getTime();
				        //var url_report_read = 'GET::<t t-esc="url_report_read"/>?dt=' + cur_time;
				        var url_report_read = 'GET::<t t-esc="rubylong_file_path"/>?dt=' + cur_time;
				        var url_data_load = 'GET::<t t-raw='docs[0].rubylong_xml_file'/>?dt=' + cur_time;
					    //var to_desigin = <t t-esc="to_design"/>;\
					    var to_desigin = false;
				        if (!to_desigin) {		
				        	CreatePrintViewerEx("100%", "100%", url_report_read , url_data_load, true, "&lt;param name=BorderStyle value=1&gt;");
				        } else {
				        	/*
				        	TODO Since rubylong can not get the seesion's cookie under firefox and chrome, 
				        	so can not find designer saving available way now
				        	wait solving method
				        	*/
				        	//goto design page
				        	//window.open('report/html/38', '_blank', 'scrollbars=1,height=900,width=1280');
				        	var url_report_write = '<t t-esc="url_report_write"/>'
				            CreateDesigner(url_report_read , '', url_data_load, "&lt;param name='BorderStyle' value='1'&gt;&lt;param name='OnSaveReport' value='OnSaveReport'&gt;");
				        }			        
					</script>
					          
				    <style type="text/css">
				        html, body {
				            margin: 0;
				            height: 100%;
				        }
				    </style>
				                    
                </head>
                <body>	
                </body>
            </html>
        </template>

    </data>
</openerp>
