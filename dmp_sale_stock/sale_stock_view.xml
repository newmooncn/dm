<openerp>
    <data>
		<record id="sales_orders_view_form_stock" model="ir.ui.view">
			<field name="name">sales_orders_view_form_stock</field>
			<field name="model">sale.order</field>
			<field name="inherit_id" ref="sale.view_order_form" />
			<field name="arch" type="xml">
	            <field name="shop_id" position="after">
	                <field name="picked_rate"/>
	            </field>  		            
                <xpath expr="//page[@string='Order Lines']/field[@name='order_line']/tree/field[@name='product_uom_qty']" position="after">
                    <field name="deliver_qty"/>
                    <field name="return_qty"/>
                    <field name="id" invisible="1"/>
                </xpath> 		            
                <xpath expr="//page[@string='Order Lines']/field[@name='order_line']/form//field[@name='price_unit']" position="after">
                    <field name="deliver_qty"/>
                    <field name="return_qty"/>
                </xpath>   			            
                <xpath expr="//page[@string='Order Lines']/field[@name='order_line']/tree" position="attributes">
                    <attribute name="colors"><![CDATA[red:id > 0 and state not in ('cancel', 'done', 'exception') and deliver_qty-return_qty != product_uom_qty and date_planned and current_date > date_planned]]></attribute>
                </xpath> 	
			</field>
		</record> 
		
		<record id="view_sales_order_tree_stock" model="ir.ui.view">
			<field name="name">view_sales_order_tree_stock</field>
			<field name="model">sale.order</field>
			<field name="inherit_id" ref="sale.view_order_tree" />
			<field name="arch" type="xml">
	            <field name="state" position="before">
	                <field name="picked_rate" widget="progressbar"/>
	            </field>      			
			</field>
		</record>  
    </data>
</openerp>
